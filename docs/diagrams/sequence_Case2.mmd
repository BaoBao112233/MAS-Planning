sequenceDiagram
    autonumber
    participant Client
    participant Router
    participant Manager
    participant ToolAgent as template.agent.tool
    participant MCP as mcp.client.sse
    participant History

    Client->>Router: "Turn On Light 1 in the bed room." + JWT
    Router->>Manager: Forward request
    activate Manager
    Manager->>Manager: Analyze intent → Device Control
    critical AI Decision
        Manager->>Manager: Route to Tool Agent (confidence 1.00)
    end
    Manager->>ToolAgent: Send task + token
    ToolAgent->>MCP: Connect to SSE endpoint (get_device_list)
    MCP-->>ToolAgent: Return device info
    ToolAgent->>ToolAgent: Execute switch_on_off_controls_v2
    ToolAgent-->>Manager: ✅ Command executed
    Manager->>History: Save to session
    deactivate Manager
    Router-->>Client: Response OK
